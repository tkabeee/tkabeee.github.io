!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i extends Phaser.State{preload(){}create(){this.game.state.start("Preloader",!0,!1)}render(){}}class r extends Phaser.State{preload(){this.load.image("unit","assets/phaser/unit.png"),this.load.image("block","assets/phaser/block.png"),this.load.image("bullet","assets/phaser/bullet.png"),this.load.spritesheet("kaboom","assets/phaser/explosion.png",64,64,23)}create(){this.game.state.start("Build",!0,!1)}}class a{}a.numTotal=8,a.health=3;class o{}o.angle=-90,o.faceForward=!0,o.point=new Phaser.Point,o.minVelocity=-200,o.maxVelocity=320,o.currentSpeed=0,o.acceleration=6,o.deceleration=4,o.rotationAngle=2,o.fireRate=300,o.fireAsDegrees=!0,o.fireVelocity=600;class h{constructor(t){this.state={},this.sprite=t,this.sprite.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.anchor.setTo(.5,.5),this.sprite.x=250,this.sprite.y=400;const e=new Phaser.Rectangle(0,32,32,32);this.sprite.crop(e,!1),this.sprite.body.drag.set(.2),this.sprite.body.maxVelocity.setTo(400,400),this.sprite.body.collideWorldBounds=!0,this.sprite.bringToTop(),this.sprite.angle=o.angle,this.state={faceForward:o.faceForward,point:new Phaser.Point,currentSpeed:o.currentSpeed,bulletTime:0}}goReady(){0==this.state.currentSpeed&&(this.state.faceForward=!this.state.faceForward)}decelerate(){this.state.currentSpeed<=0?this.state.currentSpeed=0:o.maxVelocity%2<this.state.currentSpeed?this.state.currentSpeed-=2*o.deceleration:this.state.currentSpeed-=o.deceleration}goFront(){this.state.faceForward?this.state.currentSpeed<o.maxVelocity?this.state.currentSpeed+=o.acceleration:this.state.currentSpeed=o.maxVelocity:(this.decelerate(),this.goReady()),this.sprite.game.physics.arcade.velocityFromAngle(this.sprite.angle,this.state.currentSpeed,this.sprite.body.velocity)}goBack(){this.state.faceForward?(this.decelerate(),this.goReady()):o.minVelocity<this.state.currentSpeed?this.state.currentSpeed-=o.deceleration:this.state.currentSpeed=o.minVelocity,this.sprite.game.physics.arcade.velocityFromAngle(this.sprite.angle,this.state.currentSpeed,this.sprite.body.velocity)}rotate(t){if(!(this.state.currentSpeed<=0)){switch(!0){case"left"==t:this.sprite.angle-=o.rotationAngle;break;case"right"==t:this.sprite.angle+=o.rotationAngle}this.sprite.game.physics.arcade.velocityFromAngle(this.sprite.angle,this.state.currentSpeed,this.sprite.body.velocity)}}rotateRight(){this.rotate("right")}rotateLeft(){this.rotate("left")}fire(t){const e=this.sprite.game.time.now;if(e<this.state.bulletTime)return;this.state.bulletTime=e+o.fireRate;const s=t.getFirstExists(!1);s&&(s.reset(this.sprite.x,this.sprite.y),s.body.velocity.rotate(0,0,this.sprite.angle,o.fireAsDegrees,o.fireVelocity))}hitBullet(t,e){e.kill(),t.damage()}}class n{constructor(t){this.state={},this.sprite=t,this.sprite.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.anchor.set(.5),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.sprite.body.bounce.setTo(0,0),this.state={health:a.health,alive:!0}}damage(){return this.state.health-=1,!(this.state.health>0)&&(this.state.alive=!1,this.sprite.kill(),console.log("kill!!"),!0)}}class l extends Phaser.State{constructor(){super(...arguments),this.enemies=[],this.inputKeys={}}preload(){}create(){this.world.setBounds(0,0,this.game.width,this.game.height);const t=this.game.add.sprite(0,0,"unit");this.unit=new h(t);let e=a.numTotal;for(;e>0;){const t=this.game.add.sprite(this.world.randomX,this.world.randomY,"undefined"),s=new n(t);this.enemies.push(s.sprite),e--}this.bullets=this.game.add.group(),this.bullets.enableBody=!0,this.bullets.physicsBodyType=Phaser.Physics.ARCADE,this.bullets.createMultiple(3,"bullet",0,!1),this.bullets.setAll("anchor.x",.5),this.bullets.setAll("anchor.y",.5),this.bullets.setAll("outOfBoundsKill",!0),this.bullets.setAll("checkWorldBounds",!0),this.explosions=this.game.add.group(),this.explosions.enableBody=!0,this.explosions.physicsBodyType=Phaser.Physics.ARCADE,this.explosions.createMultiple(30,"kaboom"),this.explosions.setAll("anchor.x",.5),this.explosions.setAll("anchor.y",.5),this.explosions.forEach(t=>{t.animations.add("kaboom")}),this.inputKeys.cursors=this.game.input.keyboard.createCursorKeys(),this.inputKeys.spacebar=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR])}update(){this.inputKeys.cursors.left.isDown&&this.unit.rotateLeft(),this.inputKeys.cursors.right.isDown&&this.unit.rotateRight(),this.inputKeys.cursors.up.isDown&&this.unit.goFront(),this.inputKeys.cursors.down.isDown&&this.unit.goBack(),this.inputKeys.spacebar.isDown&&this.unit.fire(this.bullets);for(var t=0;t<this.enemies.length;t++)this.enemies[t].alive&&this.game.physics.arcade.overlap(this.bullets,this.enemies[t].sprite,this.unit.hitBullet,null,this)}}window.onload=(()=>{new class extends Phaser.Game{constructor(t,e){super(t,e,Phaser.AUTO,"field",null),this.size={},this.state.add("Boot",i,!1),this.state.add("Preloader",r,!1),this.state.add("Build",l,!1),this.state.start("Boot")}}(window.innerWidth,window.innerHeight)})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jvb3QudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3ByZWxvYWRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY29uc3RhbnRzL2VuZW15LnRzIiwid2VicGFjazovLy8uL3NyYy9jb25zdGFudHMvcGxheWVyLnRzIiwid2VicGFjazovLy8uL3NyYy9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2NrLnRzIiwid2VicGFjazovLy8uL3NyYy9idWlsZC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvYXBwLnRzIiwid2VicGFjazovLy8uL3NyYy9nYW1lLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJCb290IiwiUGhhc2VyIiwiU3RhdGUiLCJbb2JqZWN0IE9iamVjdF0iLCJ0aGlzIiwiZ2FtZSIsInN0YXRlIiwic3RhcnQiLCJQcmVsb2FkZXIiLCJsb2FkIiwiaW1hZ2UiLCJzcHJpdGVzaGVldCIsIkNvbnN0YW50RW5lbXkiLCJudW1Ub3RhbCIsImhlYWx0aCIsIkNvbnN0YW50UGxheWVyIiwiYW5nbGUiLCJmYWNlRm9yd2FyZCIsInBvaW50IiwiUG9pbnQiLCJtaW5WZWxvY2l0eSIsIm1heFZlbG9jaXR5IiwiY3VycmVudFNwZWVkIiwiYWNjZWxlcmF0aW9uIiwiZGVjZWxlcmF0aW9uIiwicm90YXRpb25BbmdsZSIsImZpcmVSYXRlIiwiZmlyZUFzRGVncmVlcyIsImZpcmVWZWxvY2l0eSIsInBsYXllcl9QbGF5ZXIiLCJzcHJpdGUiLCJwaHlzaWNzIiwiZW5hYmxlIiwiUGh5c2ljcyIsIkFSQ0FERSIsImFuY2hvciIsInNldFRvIiwieCIsInkiLCJjcm9wUmVjdCIsIlJlY3RhbmdsZSIsImNyb3AiLCJib2R5IiwiZHJhZyIsInNldCIsImNvbGxpZGVXb3JsZEJvdW5kcyIsImJyaW5nVG9Ub3AiLCJidWxsZXRUaW1lIiwiZGVjZWxlcmF0ZSIsImdvUmVhZHkiLCJhcmNhZGUiLCJ2ZWxvY2l0eUZyb21BbmdsZSIsInZlbG9jaXR5IiwiZGlyZWN0aW9uIiwicm90YXRlIiwiYnVsbGV0cyIsIm5vdyIsInRpbWUiLCJidWxsZXQiLCJnZXRGaXJzdEV4aXN0cyIsInJlc2V0IiwiZW5lbXkiLCJraWxsIiwiZGFtYWdlIiwiYmxvY2tfQmxvY2siLCJpbW1vdmFibGUiLCJib3VuY2UiLCJhbGl2ZSIsImNvbnNvbGUiLCJsb2ciLCJidWlsZF9CdWlsZCIsImVuZW1pZXMiLCJpbnB1dEtleXMiLCJ3b3JsZCIsInNldEJvdW5kcyIsIndpZHRoIiwiaGVpZ2h0Iiwic3ByaXRlVW5pdCIsImFkZCIsInVuaXQiLCJlbmVteUNvdW50Iiwic3ByaXRlQmxvY2siLCJyYW5kb21YIiwicmFuZG9tWSIsImJsb2NrIiwicHVzaCIsImdyb3VwIiwiZW5hYmxlQm9keSIsInBoeXNpY3NCb2R5VHlwZSIsImNyZWF0ZU11bHRpcGxlIiwic2V0QWxsIiwiZXhwbG9zaW9ucyIsImZvckVhY2giLCJleHBsb3Npb24iLCJhbmltYXRpb25zIiwiY3Vyc29ycyIsImlucHV0Iiwia2V5Ym9hcmQiLCJjcmVhdGVDdXJzb3JLZXlzIiwic3BhY2ViYXIiLCJhZGRLZXkiLCJLZXlib2FyZCIsIlNQQUNFQkFSIiwiYWRkS2V5Q2FwdHVyZSIsImxlZnQiLCJpc0Rvd24iLCJyb3RhdGVMZWZ0IiwicmlnaHQiLCJyb3RhdGVSaWdodCIsInVwIiwiZ29Gcm9udCIsImRvd24iLCJnb0JhY2siLCJmaXJlIiwibGVuZ3RoIiwib3ZlcmxhcCIsImhpdEJ1bGxldCIsIndpbmRvdyIsIm9ubG9hZCIsIkdhbWUiLCJzdXBlciIsIkFVVE8iLCJzaXplIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0Il0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFaLEVBQUFtQixFQUFBLFNBQUFqQixHQUNBWSxPQUFBQyxlQUFBYixFQUFBLGNBQWlEa0IsT0FBQSxLQUlqRHBCLEVBQUFxQixFQUFBLFNBQUFsQixHQUNBLElBQUFTLEVBQUFULEtBQUFtQixXQUNBLFdBQTJCLE9BQUFuQixFQUFBLFNBQzNCLFdBQWlDLE9BQUFBLEdBRWpDLE9BREFILEVBQUFVLEVBQUFFLEVBQUEsSUFBQUEsR0FDQUEsR0FJQVosRUFBQWEsRUFBQSxTQUFBVSxFQUFBQyxHQUFzRCxPQUFBVixPQUFBVyxVQUFBQyxlQUFBbkIsS0FBQWdCLEVBQUFDLElBR3REeEIsRUFBQTJCLEVBQUEsR0FJQTNCLElBQUE0QixFQUFBLCtDQ2pFY0MsVUFBb0JDLE9BQU9DLE1BQ3ZDQyxXQUVBQSxTQUNFQyxLQUFLQyxLQUFLQyxNQUFNQyxNQUFNLGFBQWEsR0FBTSxHQUUzQ0osaUJDTllLLFVBQXlCUCxP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RyxHQUFHdUQsT0FBUTFCLEtBQUsyRSxLQUFLcUMsVUFBVyxLQUFNaEgsT0M1RjFHaUgsT0FBT0MsT0FBUyxNQUNELGtCQ0dtQnJILE9BQU9zSCxLQUV2Q3BILFlBQVl3RSxFQUFlQyxHQUN6QjRDLE1BQU03QyxFQUFPQyxFQUFRM0UsT0FBT3dILEtBQU0sUUFBUyxNQUZyQ3JILEtBQUFzSCxRQUlOdEgsS0FBS0UsTUFBTXdFLElBQUksT0FBUTlFLEdBQU0sR0FDN0JJLEtBQUtFLE1BQU13RSxJQUFJLFlBQWF0RSxHQUFXLEdBQ3ZDSixLQUFLRSxNQUFNd0UsSUFBSSxRQUFTUixHQUFPLEdBRS9CbEUsS0FBS0UsTUFBTUMsTUFBTSxVRFpHOEcsT0FBT00sV0FBWU4sT0FBT08iLCJmaWxlIjoiZ2FtZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwibGlicy9waGFzZXIvcGhhc2VyLmQudHNcIiAvPlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCb290IGV4dGVuZHMgUGhhc2VyLlN0YXRlIHtcbiAgcHJlbG9hZCgpIHtcbiAgfVxuICBjcmVhdGUoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInLCB0cnVlLCBmYWxzZSlcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgLy8gdGhpcy5nYW1lLmRlYnVnLmJvZHlJbmZvKHVuaXQsIDMyLCAzMik7XG4gICAgLy8gdGhpcy5nYW1lLmRlYnVnLnNwcml0ZUluZm8odW5pdCwgMzIsIDE0MCk7XG4gIH1cbn1cbiIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJsaWJzL3BoYXNlci9waGFzZXIuZC50c1wiIC8+XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByZWxvYWRlciBleHRlbmRzIFBoYXNlci5TdGF0ZSB7XG4gIHByZWxvYWQoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCd1bml0JywgJ2Fzc2V0cy9waGFzZXIvdW5pdC5wbmcnKVxuICAgIHRoaXMubG9hZC5pbWFnZSgnYmxvY2snLCAnYXNzZXRzL3BoYXNlci9ibG9jay5wbmcnKVxuICAgIHRoaXMubG9hZC5pbWFnZSgnYnVsbGV0JywgJ2Fzc2V0cy9waGFzZXIvYnVsbGV0LnBuZycpXG4gICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdrYWJvb20nLCAnYXNzZXRzL3BoYXNlci9leHBsb3Npb24ucG5nJywgNjQsIDY0LCAyMylcbiAgfVxuICBjcmVhdGUoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdCdWlsZCcsIHRydWUsIGZhbHNlKVxuICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uc3RhbnRFbmVteSB7XG4gIC8vIOe3j+aVsFxuICBwdWJsaWMgc3RhdGljIG51bVRvdGFsID0gOFxuICAvLyDjg6njgqTjg5XmlbBcbiAgcHVibGljIHN0YXRpYyBoZWFsdGggPSAzXG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDb25zdGFudFBsYXllciB7XG4gIC8vIOinkuW6plxuICBwdWJsaWMgc3RhdGljIGFuZ2xlID0gLTkwICAvLyDmraPpnaJcbiAgLy8g5pa55ZCRXG4gIHB1YmxpYyBzdGF0aWMgZmFjZUZvcndhcmQgPSB0cnVlIC8vIOWJjTp0cnVlIOW+jOOCjTpmYWxzZVxuICAvLyBQb2ludCBvYmplY3RcbiAgcHVibGljIHN0YXRpYyBwb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQoKVxuICAvLyDln7rmnKzpgJ/luqZcbiAgcHVibGljIHN0YXRpYyBtaW5WZWxvY2l0eSA9IC0yMDBcbiAgcHVibGljIHN0YXRpYyBtYXhWZWxvY2l0eSA9IDMyMFxuICAvLyDnj77lnKjjga7pgJ/luqZcbiAgcHVibGljIHN0YXRpYyBjdXJyZW50U3BlZWQgPSAwXG4gIC8vIOWKoOmAn+WApFxuICBwdWJsaWMgc3RhdGljIGFjY2VsZXJhdGlvbiA9IDZcbiAgLy8g5rib6YCf5YCkXG4gIHB1YmxpYyBzdGF0aWMgZGVjZWxlcmF0aW9uID0gNFxuICAvLyDlm57ou6Lop5LluqZcbiAgcHVibGljIHN0YXRpYyByb3RhdGlvbkFuZ2xlID0gMlxuXG4gIC8vIOegsuaSg+OBrumWk+malFxuICBwdWJsaWMgc3RhdGljIGZpcmVSYXRlID0gMzAwXG4gIC8vIOegsuaSg+OBruWKoOa4m1xuICBwdWJsaWMgc3RhdGljIGZpcmVBc0RlZ3JlZXMgPSB0cnVlXG4gIC8vIOW8vuS4uOOBrumAn+W6plxuICBwdWJsaWMgc3RhdGljIGZpcmVWZWxvY2l0eSA9IDYwMFxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cImxpYnMvcGhhc2VyL3BoYXNlci5kLnRzXCIgLz5cblxuaW1wb3J0IENvbnN0YW50UGxheWVyIGZyb20gXCIuL2NvbnN0YW50cy9wbGF5ZXJcIlxuaW1wb3J0IEJsb2NrIGZyb20gXCIuL2Jsb2NrXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyIHtcbiAgcHVibGljIHNwcml0ZTogUGhhc2VyLlNwcml0ZVxuICBwcml2YXRlIHN0YXRlOiBhbnkgPSB7fVxuXG4gIGNvbnN0cnVjdG9yKHNwcml0ZTogUGhhc2VyLlNwcml0ZSkge1xuICAgIHRoaXMuc3ByaXRlID0gc3ByaXRlXG4gICAgdGhpcy5zcHJpdGUuZ2FtZS5waHlzaWNzLmVuYWJsZSh0aGlzLnNwcml0ZSwgUGhhc2VyLlBoeXNpY3MuQVJDQURFKVxuICAgIHRoaXMuc3ByaXRlLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICAvLyBNb3ZlXG4gICAgdGhpcy5zcHJpdGUueCA9IDI1MFxuICAgIHRoaXMuc3ByaXRlLnkgPSA0MDBcbiAgICAvLyBDcm9wXG4gICAgY29uc3QgY3JvcFJlY3QgPSBuZXcgUGhhc2VyLlJlY3RhbmdsZSgwLCAzMiwgMzIsIDMyKVxuICAgIHRoaXMuc3ByaXRlLmNyb3AoY3JvcFJlY3QsIGZhbHNlKVxuICAgIHRoaXMuc3ByaXRlLmJvZHkuZHJhZy5zZXQoMC4yKVxuICAgIC8vIFRoZSBtYXhpbXVtIHZlbG9jaXR5IGluIHBpeGVscyBwZXIgc2Vjb25kIHNxLiB0aGF0IHRoZSBCb2R5IGNhbiByZWFjaC5cbiAgICB0aGlzLnNwcml0ZS5ib2R5Lm1heFZlbG9jaXR5LnNldFRvKDQwMCwgNDAwKVxuICAgIC8vIGNvbGxpZGUgd29ybGQgYm91bmRzXG4gICAgdGhpcy5zcHJpdGUuYm9keS5jb2xsaWRlV29ybGRCb3VuZHMgPSB0cnVlXG5cbiAgICAvLyBCcmluZ3MgdGhlIFNwcml0ZSB0byB0aGUgdG9wIG9mIHRoZSBkaXNwbGF5IGxpc3QgaXQgaXMgYSBjaGlsZCBvZi5cbiAgICAvLyBodHRwOi8vZG9jcy5waGFzZXIuaW8vUGhhc2VyLlNwcml0ZS5odG1sI2JyaW5nVG9Ub3BcbiAgICB0aGlzLnNwcml0ZS5icmluZ1RvVG9wKClcblxuICAgIHRoaXMuc3ByaXRlLmFuZ2xlID0gQ29uc3RhbnRQbGF5ZXIuYW5nbGVcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgZmFjZUZvcndhcmQ6IDxib29sZWFuPiBDb25zdGFudFBsYXllci5mYWNlRm9yd2FyZCxcbiAgICAgIHBvaW50OiA8UGhhc2VyLlBvaW50PiBuZXcgUGhhc2VyLlBvaW50KCksXG4gICAgICBjdXJyZW50U3BlZWQ6IDxudW1iZXI+IENvbnN0YW50UGxheWVyLmN1cnJlbnRTcGVlZCxcbiAgICAgIGJ1bGxldFRpbWU6IDxudW1iZXI+IDBcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdvUmVhZHkoKSA6IHZvaWQge1xuICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRTcGVlZCA9PSAwKVxuICAgIHtcbiAgICAgIC8vIOmAsuihjOaWueWQkeOCkuWkieabtFxuICAgICAgdGhpcy5zdGF0ZS5mYWNlRm9yd2FyZCA9ICF0aGlzLnN0YXRlLmZhY2VGb3J3YXJkXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkZWNlbGVyYXRlKCkgOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50U3BlZWQgPD0gMClcbiAgICB7XG4gICAgICB0aGlzLnN0YXRlLmN1cnJlbnRTcGVlZCA9IDBcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGlmICgoQ29uc3RhbnRQbGF5ZXIubWF4VmVsb2NpdHkgJSAyKSA8IHRoaXMuc3RhdGUuY3VycmVudFNwZWVkKVxuICAgIHtcbiAgICAgIHRoaXMuc3RhdGUuY3VycmVudFNwZWVkIC09IChDb25zdGFudFBsYXllci5kZWNlbGVyYXRpb24gKiAyKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZS5jdXJyZW50U3BlZWQgLT0gQ29uc3RhbnRQbGF5ZXIuZGVjZWxlcmF0aW9uXG4gIH1cblxuICBwdWJsaWMgZ29Gcm9udCgpIDogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLmZhY2VGb3J3YXJkKVxuICAgIHtcbiAgICAgIHRoaXMuZGVjZWxlcmF0ZSgpXG4gICAgICB0aGlzLmdvUmVhZHkoKVxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgaWYgKHRoaXMuc3RhdGUuY3VycmVudFNwZWVkIDwgQ29uc3RhbnRQbGF5ZXIubWF4VmVsb2NpdHkpXG4gICAgICB7XG4gICAgICAgIHRoaXMuc3RhdGUuY3VycmVudFNwZWVkICs9IENvbnN0YW50UGxheWVyLmFjY2VsZXJhdGlvblxuICAgICAgfVxuICAgICAgZWxzZVxuICAgICAge1xuICAgICAgICB0aGlzLnN0YXRlLmN1cnJlbnRTcGVlZCA9IENvbnN0YW50UGxheWVyLm1heFZlbG9jaXR5XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zcHJpdGUuZ2FtZS5waHlzaWNzLmFyY2FkZS52ZWxvY2l0eUZyb21BbmdsZSh0aGlzLnNwcml0ZS5hbmdsZSwgdGhpcy5zdGF0ZS5jdXJyZW50U3BlZWQsIHRoaXMuc3ByaXRlLmJvZHkudmVsb2NpdHkpXG4gIH1cblxuICBwdWJsaWMgZ29CYWNrKCkgOiB2b2lkIHtcbiAgICAvLyDmuJvpgJ/liY3pgLLkuK1cbiAgICBpZiAodGhpcy5zdGF0ZS5mYWNlRm9yd2FyZClcbiAgICB7XG4gICAgICB0aGlzLmRlY2VsZXJhdGUoKVxuICAgICAgdGhpcy5nb1JlYWR5KClcbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgIGlmIChDb25zdGFudFBsYXllci5taW5WZWxvY2l0eSA8IHRoaXMuc3RhdGUuY3VycmVudFNwZWVkKVxuICAgICAge1xuICAgICAgICB0aGlzLnN0YXRlLmN1cnJlbnRTcGVlZCAtPSBDb25zdGFudFBsYXllci5kZWNlbGVyYXRpb25cbiAgICAgIH1cbiAgICAgIGVsc2VcbiAgICAgIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5jdXJyZW50U3BlZWQgPSBDb25zdGFudFBsYXllci5taW5WZWxvY2l0eVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc3ByaXRlLmdhbWUucGh5c2ljcy5hcmNhZGUudmVsb2NpdHlGcm9tQW5nbGUodGhpcy5zcHJpdGUuYW5nbGUsIHRoaXMuc3RhdGUuY3VycmVudFNwZWVkLCB0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5KVxuICB9XG5cbiAgcHJpdmF0ZSByb3RhdGUoZGlyZWN0aW9uOiBzdHJpbmcpIDogdm9pZCB7XG4gICAgaWYgKHRoaXMuc3RhdGUuY3VycmVudFNwZWVkIDw9IDApXG4gICAge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICBjYXNlIGRpcmVjdGlvbiA9PSAnbGVmdCc6XG4gICAgICAgIHRoaXMuc3ByaXRlLmFuZ2xlIC09IENvbnN0YW50UGxheWVyLnJvdGF0aW9uQW5nbGVcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgZGlyZWN0aW9uID09ICdyaWdodCc6XG4gICAgICAgIHRoaXMuc3ByaXRlLmFuZ2xlICs9IENvbnN0YW50UGxheWVyLnJvdGF0aW9uQW5nbGVcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICB0aGlzLnNwcml0ZS5nYW1lLnBoeXNpY3MuYXJjYWRlLnZlbG9jaXR5RnJvbUFuZ2xlKHRoaXMuc3ByaXRlLmFuZ2xlLCB0aGlzLnN0YXRlLmN1cnJlbnRTcGVlZCwgdGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eSlcbiAgfVxuXG4gIHB1YmxpYyByb3RhdGVSaWdodCgpIDogdm9pZCB7XG4gICAgdGhpcy5yb3RhdGUoJ3JpZ2h0JylcbiAgfVxuXG4gIHB1YmxpYyByb3RhdGVMZWZ0KCkgOiB2b2lkIHtcbiAgICB0aGlzLnJvdGF0ZSgnbGVmdCcpXG4gIH1cblxuICBwdWJsaWMgZmlyZShidWxsZXRzOiBQaGFzZXIuR3JvdXApIDogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gdGhpcy5zcHJpdGUuZ2FtZS50aW1lLm5vd1xuICAgIGlmIChub3cgPCB0aGlzLnN0YXRlLmJ1bGxldFRpbWUpIHJldHVyblxuICAgIHRoaXMuc3RhdGUuYnVsbGV0VGltZSA9IG5vdyArIENvbnN0YW50UGxheWVyLmZpcmVSYXRlXG4gICAgY29uc3QgYnVsbGV0ID0gYnVsbGV0cy5nZXRGaXJzdEV4aXN0cyhmYWxzZSlcbiAgICBpZiAoIWJ1bGxldCkgcmV0dXJuXG4gICAgYnVsbGV0LnJlc2V0KHRoaXMuc3ByaXRlLngsIHRoaXMuc3ByaXRlLnkpXG4gICAgYnVsbGV0LmJvZHkudmVsb2NpdHkucm90YXRlKDAsIDAsIHRoaXMuc3ByaXRlLmFuZ2xlLCBDb25zdGFudFBsYXllci5maXJlQXNEZWdyZWVzLCBDb25zdGFudFBsYXllci5maXJlVmVsb2NpdHkpXG4gIH1cblxuICBwdWJsaWMgaGl0QnVsbGV0KGVuZW15OiBCbG9jaywgYnVsbGV0OiBQaGFzZXIuU3ByaXRlKSA6IHZvaWQge1xuICAgIGJ1bGxldC5raWxsKClcbiAgICBlbmVteS5kYW1hZ2UoKVxuICAgIC8vIFRPRE86IOeIhueZulxuICAgIC8vIGNvbnN0IGV4cGxvc2lvbiA9IGV4cGxvc2lvbnMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpXG4gICAgLy8gZXhwbG9zaW9uLnJlc2V0KGVuZW15LnNwcml0ZS54LCBlbmVteS5zcHJpdGUueSlcbiAgICAvLyBleHBsb3Npb24ucGxheSgna2Fib29tJywgMzAsIGZhbHNlLCB0cnVlKVxuICB9XG5cbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwibGlicy9waGFzZXIvcGhhc2VyLmQudHNcIiAvPlxuXG5pbXBvcnQgQ29uc3RhbnRFbmVteSBmcm9tIFwiLi9jb25zdGFudHMvZW5lbXlcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmxvY2sge1xuICBwdWJsaWMgc3ByaXRlOiBQaGFzZXIuU3ByaXRlXG4gIHByaXZhdGUgc3RhdGU6IGFueSA9IHt9XG4gIGNvbnN0cnVjdG9yKHNwcml0ZTogUGhhc2VyLlNwcml0ZSkge1xuICAgIHRoaXMuc3ByaXRlID0gc3ByaXRlXG4gICAgdGhpcy5zcHJpdGUuZ2FtZS5waHlzaWNzLmVuYWJsZSh0aGlzLnNwcml0ZSwgUGhhc2VyLlBoeXNpY3MuQVJDQURFKVxuICAgIHRoaXMuc3ByaXRlLmFuY2hvci5zZXQoMC41KVxuICAgIC8vIOWbuuWumuOBmeOCi1xuICAgIHRoaXMuc3ByaXRlLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZVxuICAgIC8vIOODnuODg+ODl+WkluOBuOOBruWLleS9nFxuICAgIHRoaXMuc3ByaXRlLmJvZHkuY29sbGlkZVdvcmxkQm91bmRzID0gdHJ1ZVxuICAgIC8vIGJvdW5jZeioreWumlxuICAgIHRoaXMuc3ByaXRlLmJvZHkuYm91bmNlLnNldFRvKDAsIDApXG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaGVhbHRoOiA8bnVtYmVyPiBDb25zdGFudEVuZW15LmhlYWx0aCxcbiAgICAgIGFsaXZlOiA8Ym9vbGVhbj4gdHJ1ZVxuICAgIH1cbiAgfVxuXG4gIGRhbWFnZSgpIHtcbiAgICB0aGlzLnN0YXRlLmhlYWx0aCAtPSAxXG5cbiAgICBpZiAodGhpcy5zdGF0ZS5oZWFsdGggPiAwKVxuICAgIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHRoaXMuc3RhdGUuYWxpdmUgPSBmYWxzZVxuICAgIHRoaXMuc3ByaXRlLmtpbGwoKVxuICAgIGNvbnNvbGUubG9nKCdraWxsISEnKVxuXG4gICAgcmV0dXJuIHRydWVcbiAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cImxpYnMvcGhhc2VyL3BoYXNlci5kLnRzXCIgLz5cblxuaW1wb3J0IENvbnN0YW50RW5lbXkgZnJvbSBcIi4vY29uc3RhbnRzL2VuZW15XCJcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCJcbmltcG9ydCBCbG9jayBmcm9tIFwiLi9ibG9ja1wiXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJ1aWxkIGV4dGVuZHMgUGhhc2VyLlN0YXRlIHtcbiAgcHJpdmF0ZSB1bml0OiBQbGF5ZXJcbiAgcHJpdmF0ZSBlbmVtaWVzOiBhbnkgPSBbXVxuICBwcml2YXRlIGJ1bGxldHM6IFBoYXNlci5Hcm91cFxuICBwcml2YXRlIGV4cGxvc2lvbnM6IFBoYXNlci5Hcm91cFxuICBwcml2YXRlIGlucHV0S2V5czogYW55ID0ge31cblxuICBwcmVsb2FkKCkge1xuICB9XG5cbiAgY3JlYXRlKCkge1xuICAgIHRoaXMud29ybGQuc2V0Qm91bmRzKDAsIDAsIHRoaXMuZ2FtZS53aWR0aCwgdGhpcy5nYW1lLmhlaWdodClcblxuICAgIC8vIENyZWF0ZSBQbGF5ZXJcbiAgICBjb25zdCBzcHJpdGVVbml0ID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoMCwgMCwgJ3VuaXQnKVxuICAgIHRoaXMudW5pdCA9IG5ldyBQbGF5ZXIoc3ByaXRlVW5pdClcblxuICAgIC8vIENyZWF0ZSBFbmVtaWVzXG4gICAgbGV0IGVuZW15Q291bnQgPSBDb25zdGFudEVuZW15Lm51bVRvdGFsXG4gICAgd2hpbGUgKGVuZW15Q291bnQgPiAwKSB7XG4gICAgICBjb25zdCBzcHJpdGVCbG9jayA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHRoaXMud29ybGQucmFuZG9tWCwgdGhpcy53b3JsZC5yYW5kb21ZLCAndW5kZWZpbmVkJylcbiAgICAgIGNvbnN0IGJsb2NrID0gbmV3IEJsb2NrKHNwcml0ZUJsb2NrKVxuICAgICAgdGhpcy5lbmVtaWVzLnB1c2goYmxvY2suc3ByaXRlKVxuICAgICAgZW5lbXlDb3VudC0tXG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIEJ1bGxldHNcbiAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKClcbiAgICB0aGlzLmJ1bGxldHMuZW5hYmxlQm9keSA9IHRydWVcbiAgICB0aGlzLmJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFXG4gICAgdGhpcy5idWxsZXRzLmNyZWF0ZU11bHRpcGxlKDMsICdidWxsZXQnLCAwLCBmYWxzZSlcbiAgICB0aGlzLmJ1bGxldHMuc2V0QWxsKCdhbmNob3IueCcsIDAuNSlcbiAgICB0aGlzLmJ1bGxldHMuc2V0QWxsKCdhbmNob3IueScsIDAuNSlcbiAgICB0aGlzLmJ1bGxldHMuc2V0QWxsKCdvdXRPZkJvdW5kc0tpbGwnLCB0cnVlKVxuICAgIHRoaXMuYnVsbGV0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKVxuXG4gICAgLy8gIEV4cGxvc2lvbiBwb29sXG4gICAgdGhpcy5leHBsb3Npb25zID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpXG4gICAgdGhpcy5leHBsb3Npb25zLmVuYWJsZUJvZHkgPSB0cnVlXG4gICAgdGhpcy5leHBsb3Npb25zLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERVxuICAgIHRoaXMuZXhwbG9zaW9ucy5jcmVhdGVNdWx0aXBsZSgzMCwgJ2thYm9vbScpXG4gICAgdGhpcy5leHBsb3Npb25zLnNldEFsbCgnYW5jaG9yLngnLCAwLjUpXG4gICAgdGhpcy5leHBsb3Npb25zLnNldEFsbCgnYW5jaG9yLnknLCAwLjUpXG4gICAgdGhpcy5leHBsb3Npb25zLmZvckVhY2goKGV4cGxvc2lvbjogUGhhc2VyLlNwcml0ZSkgPT4ge1xuICAgICAgZXhwbG9zaW9uLmFuaW1hdGlvbnMuYWRkKCdrYWJvb20nKVxuICAgIH0pXG5cbiAgICAvLyBUT0RPOiDooZ3nqoHjga7liKTlrppcblxuICAgIC8vIFRoZSBLZXlib2FyZCBJbnB1dCBtYW5hZ2VyLlxuICAgIC8vIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgNCBob3RrZXlzIGZvciBVcCwgRG93biwgTGVmdCBhbmQgUmlnaHQuXG4gICAgdGhpcy5pbnB1dEtleXMuY3Vyc29ycyA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5jcmVhdGVDdXJzb3JLZXlzKClcbiAgICB0aGlzLmlucHV0S2V5cy5zcGFjZWJhciA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLlNQQUNFQkFSKVxuXG4gICAgLy8gIFN0b3AgdGhlIGZvbGxvd2luZyBrZXlzIGZyb20gcHJvcGFnYXRpbmcgdXAgdG8gdGhlIGJyb3dzZXJcbiAgICB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5Q2FwdHVyZShbUGhhc2VyLktleWJvYXJkLlNQQUNFQkFSXSlcbiAgfVxuXG4gIHVwZGF0ZSgpIHtcbiAgICAvLyDlt6bml4vlm55cbiAgICBpZiAodGhpcy5pbnB1dEtleXMuY3Vyc29ycy5sZWZ0LmlzRG93bikge1xuICAgICAgdGhpcy51bml0LnJvdGF0ZUxlZnQoKVxuICAgIH1cblxuICAgIC8vIOW3puaXi+WbnlxuICAgIGlmICh0aGlzLmlucHV0S2V5cy5jdXJzb3JzLnJpZ2h0LmlzRG93bikge1xuICAgICAgdGhpcy51bml0LnJvdGF0ZVJpZ2h0KClcbiAgICB9XG5cbiAgICAvLyDliY3pgLJcbiAgICBpZiAodGhpcy5pbnB1dEtleXMuY3Vyc29ycy51cC5pc0Rvd24pIHtcbiAgICAgIHRoaXMudW5pdC5nb0Zyb250KClcbiAgICB9XG5cbiAgICAvLyDlvozpgLJcbiAgICBpZiAodGhpcy5pbnB1dEtleXMuY3Vyc29ycy5kb3duLmlzRG93bikge1xuICAgICAgdGhpcy51bml0LmdvQmFjaygpXG4gICAgfVxuXG4gICAgLy8gU2hvb3RcbiAgICBpZiAodGhpcy5pbnB1dEtleXMuc3BhY2ViYXIuaXNEb3duKSB7XG4gICAgICB0aGlzLnVuaXQuZmlyZSh0aGlzLmJ1bGxldHMpXG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVuZW1pZXMubGVuZ3RoOyBpKyspXG4gICAge1xuICAgICAgaWYgKHRoaXMuZW5lbWllc1tpXS5hbGl2ZSlcbiAgICAgIHtcbiAgICAgICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAodGhpcy5idWxsZXRzLCB0aGlzLmVuZW1pZXNbaV0uc3ByaXRlLCB0aGlzLnVuaXQuaGl0QnVsbGV0LCBudWxsLCB0aGlzKVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IEdhbWUgZnJvbSBcIi4vZ2FtZVwiXG5cbndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XG4gIGNvbnN0IGdhbWUgPSBuZXcgR2FtZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KVxufSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJsaWJzL3BoYXNlci9waGFzZXIuZC50c1wiIC8+XG5cbmltcG9ydCBCb290IGZyb20gXCIuL2Jvb3RcIlxuaW1wb3J0IFByZWxvYWRlciBmcm9tIFwiLi9wcmVsb2FkZXJcIlxuaW1wb3J0IEJ1aWxkIGZyb20gXCIuL2J1aWxkXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSBleHRlbmRzIFBoYXNlci5HYW1lIHtcbiAgcHJpdmF0ZSBzaXplOiBhbnkgPSB7fVxuICBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIHN1cGVyKHdpZHRoLCBoZWlnaHQsIFBoYXNlci5BVVRPLCAnZmllbGQnLCBudWxsKVxuXG4gICAgdGhpcy5zdGF0ZS5hZGQoJ0Jvb3QnLCBCb290LCBmYWxzZSlcbiAgICB0aGlzLnN0YXRlLmFkZCgnUHJlbG9hZGVyJywgUHJlbG9hZGVyLCBmYWxzZSlcbiAgICB0aGlzLnN0YXRlLmFkZCgnQnVpbGQnLCBCdWlsZCwgZmFsc2UpXG5cbiAgICB0aGlzLnN0YXRlLnN0YXJ0KCdCb290JylcbiAgfVxufSJdLCJzb3VyY2VSb290IjoiIn0=